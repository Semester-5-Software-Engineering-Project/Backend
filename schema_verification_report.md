Database Schema vs Entity Model Verification Report
====================================================

CRITICAL ISSUES FOUND:

1. **MISSING MIGRATION ISSUES:**
   - User entity has TOTP fields (totp_secret, two_factor_enabled) but V5 migration may not have been applied
   - ModuelDescription entity exists but table might not be created properly

2. **FIELD MISMATCHES:**

   **User Entity vs users table:**
   - Entity: @GeneratedValue (UUID) 
   - DB: id uuid not null
   - ✅ MATCH

   **ModuelDescription Entity vs module_description table:**
   - Entity: @GeneratedValue(strategy = GenerationType.AUTO) -> Long id
   - DB: id bigint generated by default as identity
   - ⚠️  POTENTIAL ISSUE: GenerationType.AUTO might not align with DB identity

   **ScheduleEntity vs schedules table:**
   - Entity: scheduleId UUID with @GeneratedValue
   - DB: schedule_id uuid not null
   - ✅ MATCH

3. **MISSING TABLES/ENTITIES:**
   The following were found in migrations but need verification:
   - event_publication (from V2 migration)
   - All entities appear to have corresponding tables

4. **COLUMN TYPE DIFFERENCES:**
   
   **ModuelsEntity (modules table):**
   - fee: numeric(10,2) in DB vs BigDecimal in entity
   - average_ratings: numeric(3,1) in DB
   
   **PaymentEntity (payments table):**
   - amount: FLOAT8 in DB vs Double in entity

5. **CONSTRAINT VERIFICATION NEEDED:**
   - Check constraints on gender, status fields
   - Foreign key relationships
   - Unique constraints on email, phone numbers

RECOMMENDATIONS:

1. **Immediate Actions:**
   ```sql
   -- Check if all migrations applied
   SELECT * FROM flyway_schema_history;
   
   -- Verify table existence
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public' ORDER BY table_name;
   
   -- Check module_description table structure
   \d module_description;
   ```

2. **Fix ModuelDescription ID Generation:**
   Change from GenerationType.AUTO to GenerationType.IDENTITY:
   ```java
   @GeneratedValue(strategy = GenerationType.IDENTITY)
   private Long id;
   ```

3. **Verify TOTP fields exist in users table:**
   ```sql
   \d users;
   ```

4. **Check for missing foreign key constraints:**
   The migration includes all necessary FK constraints.

SCHEMA VALIDATION STATUS: ⚠️  REQUIRES ATTENTION
- Most entities match their database schemas
- Key issue: module_description table creation/access
- TOTP fields may be missing from deployed database
- ID generation strategy needs verification

Next Steps:
1. Apply missing migrations to deployment database
2. Fix GenerationType in ModuelDescription
3. Verify all tables exist in deployment
4. Test entity operations after fixes